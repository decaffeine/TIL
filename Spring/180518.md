# 180518
  
### 프로젝트 : spring_12_webxml  
  
#### 기존 내용(annotation)에서 xml로 전환하기  

```  
New – Spring Legacy Project  
package – com.sist.big

기존 pom.xml 가져오기 (properties부터)
src\main\resources\log4j.xml – level value = “debug”
작동 확인 : http://localhost:8080/big/member/member.do

```

#### 
  
root-context.xml은 beans namespace  
servlet-context.xml은 mvc namespace
   
1) MemberDaoImple의 @Repository 걷어냄  
root-context.xml에 MemberDaoImple bean 추가  

```xml
		<!--  MemberDaoImple -->
		<bean id = "memberDaoImple" class = "com.sist.big.member.dao.MemberDaoImple">
		</bean>
```
 
2) MemberImple의 @Autowired, @Service 걷어냄  
root-context.xml에 MembeImple bean 추가   

```xml
		<!-- MemberImple -->
		<bean id = "memberImple" class = "com.sist.big.member.service.MemberImple">
			<property name = "memberDao" ref = "memberDaoImple"></property>
		</bean>
```
  

#### mockito  
  
https://mvnrepository.com/artifact/org.mockito/mockito-all/1.10.19
web 없이 web test 할 수 있다!

```xml
<properties>
	<org.mockito.version>1.10.19</org.mockito.version>
</properties>
<!-- https://mvnrepository.com/artifact/org.mockito/mockito-all -->
<dependency>
    <groupId>org.mockito</groupId>
    <artifactId>mockito-all</artifactId>
    <version>${org.mockito.version}</version>
    <scope>test</scope>
</dependency>
```

#### (test) MemberTest
  
- servlet 버전 수정
  
```xml
		<!-- Servlet -->
		<dependency>
			<groupId>javax.servlet</groupId>
			<artifactId>javax.servlet-api</artifactId>
			<version>3.1.0</version>
			<scope>provided</scope>
		</dependency>
```

- MemberTest.java  
  
```java
	
	@Test
	public void doSearchOnePost() throws Exception {
		log.debug("--------------------------------");
		log.debug("test");
		log.debug("--------------------------------");
		
		MockHttpServletRequestBuilder createMessage 
			= post("/member/doSearchOne.do").param("id","id1")
					.param("name","n")	
			    .param("email","s@sist.com")
		      .param("passwd","1234");
		
		mockMvc.perform(createMessage).andDo(print())
				 .andExpect(status().isOk())
			   .andExpect(status().is2xxSuccessful());
		
	}//--doSearchOnePost

}
}
```

- Log 
```
MockHttpServletRequest:
      HTTP Method = POST
      Request URI = /member/doSearchOne.do
       Parameters = {id=[id1], name=[n], email=[s@sist.com], passwd=[1234]}
          Headers = {}

Handler:
             Type = com.sist.big.member.controller.MemberController
           Method = public java.lang.String com.sist.big.member.controller.MemberController.doSearchOne(com.sist.big.member.domain.MemberVO,org.springframework.ui.Model)

Async:
    Async started = false
     Async result = null

Resolved Exception:
             Type = null

ModelAndView:
        View name = member/member
             View = null
        Attribute = memberVO
            value = MemberVO [id=id1, name=n, email=s@sist.com, passwd=1234]
           errors = []
        Attribute = outVO
            value = MemberVO [id=hyejin, name=혜진, email=sist@sist.com, passwd=1234]
           errors = []

FlashMap:
       Attributes = null

MockHttpServletResponse:
           Status = 200
    Error message = null
          Headers = {}
     Content type = null
             Body = 
    Forwarded URL = /WEB-INF/views/member/member.jsp
   Redirected URL = null
          Cookies = []
INFO : org.springframework.web.context.support.GenericWebApplicationContext - Closing org.springframework.web.context.support.GenericWebApplicationContext@1ce92674: startup date [Fri May 18 11:07:17 KST 2018]; root of context hierarchy
```

로그가 자세히 나와서 알아보기 좋다.
이걸로 테스트하고 web 연결하면 된다.

```
MockHttpServletResponse:
           Status = 405
    Error message = Request method 'POST' not supported
```
만약 post만 정해져 있는 컨트롤러를 get 방식으로 부르면 이런 오류가 나온다.
  
	


  
  
---	
### 프로젝트 : spring_13  

#### 앞으로의 흐름
```
1. (View:Bootstrap) →  2. (Controller) → UserService.java → Dao
3. Test
4. 화면은 가급적 ajax 비동기통신 이용 / 한 화면에 list와 form 동시에
5. Mybatis
    
```
  
#### 테스트하며 개발하는 과정  
```
DAO test → Service test → Controller test → View 연결
```
  
#### spring_11에서 User 관련 코드들 가져오기
```
spring_11은 패키지가 com.sist 이므로 
servlet-context.xml에서 scan base-package를 수정해 주어야 함  
```
  
- servlet-context.xml
```xml
	<context:component-scan base-package="com.sist" />
```

- root-Context.xml
	 - spring_12의 applicationContext.xml의 beans~부터를 복사해서
		 root-context.xml에 넣기
  

- (test) UserTest, UserServiceTest
	 - ContextConfiguration 추가


```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations= {
	   "file:src/main/webapp/WEB-INF/spring/root-context.xml"
		})
public class UserTest {

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations= {"file:src/main/webapp/WEB-INF/spring/root-context.xml"
		})
public class UserServiceTest {
```

UserTest, UserServiceTest 실행 후 정상 작동 확인
